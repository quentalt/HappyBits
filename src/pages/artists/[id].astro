---
// Import necessary libraries
import Layout from '../../layouts/Layout.astro';
import { supabase } from '../../lib/supabase';

// Define the `getStaticPaths` function
export async function getStaticPaths() {
  // Fetch all artist IDs from the database
  const { data: artists, error } = await supabase
      .from('artists')
      .select('id');

  if (error) {
    console.error("Error fetching artists:", error);
    return [];
  }

  // Map over the IDs to create paths for each artist
  return artists.map((artist) => ({
    params: { id: artist.id.toString() },
  }));
}

// Fetch data for the current page
const { id } = Astro.params;

const { data: artist } = await supabase
    .from('artists')
    .select('*')
    .eq('id', id)
    .single();

if (!artist) {
  return Astro.redirect('/404');
}
---

<Layout title={artist.name}>
  <article class="max-w-4xl mx-auto px-4">
    <div class="mb-8">
      <img
          src={artist.image || 'https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?auto=format&fit=crop&q=80'}
          alt={artist.name}
          class="w-full aspect-video object-cover rounded-xl"
      />
    </div>

    <div class="prose prose-lg dark:prose-invert max-w-none">
      <div class="flex items-center gap-4 mb-6">
                <span class="bg-purple-600 px-3 py-1 rounded-full text-white text-sm font-semibold">
                    {artist.genre}
                </span>
      </div>

      <h1 class="text-4xl font-bold mb-4 text-black dark:text-white">{artist.name}</h1>

      <div class="mt-8 text-gray-600 dark:text-gray-300">
        <p class="whitespace-pre-wrap">{artist.bio}</p>
      </div>

      <div class="mt-12 grid gap-8">
        <div class="bg-white dark:bg-zinc-900 rounded-lg p-6">
          <h2 class="text-2xl font-bold mb-4 text-black dark:text-white">Latest Releases</h2>
          {artist.releases && (
              <ul class="list-disc list-inside text-gray-600 dark:text-gray-300">
                {artist.releases.map((release: string) => (
                    <li>{release}</li>
                ))}
              </ul>
          )}
        </div>
      </div>
    </div>
  </article>
</Layout>
